# GuÃ­a de Desarrollo y InstalaciÃ³n - Kaia

## ğŸš€ ConfiguraciÃ³n Inicial del Proyecto

### Prerrequisitos del Sistema

#### **Software Requerido**
- **Node.js 18+**: [Descargar desde nodejs.org](https://nodejs.org/)
- **Git**: Para control de versiones
- **VS Code**: Editor recomendado con extensiones TypeScript

#### **Verificar InstalaciÃ³n**
```bash
node --version        # Debe mostrar v18+
npm --version         # Debe mostrar 8+
git --version         # Cualquier versiÃ³n reciente
```

### ClonaciÃ³n del Repositorio

```bash
# Clonar el repositorio
git clone git@github.com:tu-usuario/kaia.git
cd kaia

# Verificar estructura
ls -la
# Debe mostrar: backend/ mobile/ README.md .gitignore
```

## ğŸ“± ConfiguraciÃ³n del Frontend (Mobile)

### InstalaciÃ³n de Dependencias

```bash
cd mobile

# Instalar Expo CLI globalmente (si no estÃ¡ instalado)
npm install -g @expo/cli

# Instalar dependencias del proyecto
npm install

# Verificar instalaciÃ³n de Expo
npx expo --version
```

### Estructura del Proyecto Frontend
```
mobile/
â”œâ”€â”€ App.tsx                    # Punto de entrada principal
â”œâ”€â”€ app.json                   # ConfiguraciÃ³n de Expo
â”œâ”€â”€ package.json               # Dependencias y scripts
â”œâ”€â”€ tsconfig.json             # ConfiguraciÃ³n TypeScript
â”œâ”€â”€ babel.config.js           # ConfiguraciÃ³n Babel
â””â”€â”€ src/
    â”œâ”€â”€ screens/
    â”‚   â”œâ”€â”€ HomeScreen.tsx    # Pantalla principal
    â”‚   â””â”€â”€ ChatScreen.tsx    # Interfaz de chat con voz
    â”œâ”€â”€ components/
    â”‚   â””â”€â”€ VoiceButton.tsx   # BotÃ³n de voz personalizado
    â”œâ”€â”€ services/
    â”‚   â”œâ”€â”€ unifiedVoiceService.ts   # Servicio unificado de voz
    â”‚   â”œâ”€â”€ webVoiceService.ts       # Web Speech API (navegadores)
    â”‚   â”œâ”€â”€ voiceService.ts          # React Native Voice (mÃ³viles)
    â”‚   â””â”€â”€ nlpService.ts            # Procesamiento de lenguaje natural
    â””â”€â”€ utils/
        â””â”€â”€ constants.ts             # Constantes de diseÃ±o
```

### Scripts de Desarrollo Frontend

```bash
# Desarrollo web (navegador)
npm run web                    # Puerto 8081 por defecto
npm run web -- --port 8085   # Puerto personalizado

# Desarrollo mÃ³vil
npm start                     # Abre Expo DevTools
npx expo start               # Comando alternativo

# Builds de producciÃ³n
npm run build:web            # Build para web
npx expo build:android       # Build Android APK
npx expo build:ios          # Build iOS (requiere macOS)
```

### URLs de Desarrollo Frontend
- **Web**: http://localhost:8085
- **DevTools**: http://localhost:19002
- **Mobile**: Escanear QR con Expo Go app

## ğŸ–¥ï¸ ConfiguraciÃ³n del Backend

### InstalaciÃ³n de Dependencias

```bash
cd backend

# Instalar dependencias
npm install

# Configurar base de datos
npx prisma generate          # Generar cliente Prisma
npx prisma db push          # Crear/actualizar base de datos
```

### Estructura del Proyecto Backend
```
backend/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ server.ts            # Servidor Express principal
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma        # Esquema de base de datos
â”‚   â””â”€â”€ dev.db              # Base de datos SQLite (auto-generada)
â”œâ”€â”€ package.json             # Dependencias y scripts
â”œâ”€â”€ tsconfig.json           # ConfiguraciÃ³n TypeScript
â””â”€â”€ .env                    # Variables de entorno (crear)
```

### Variables de Entorno

Crear archivo `.env` en la carpeta `backend/`:
```env
# Database
DATABASE_URL="file:./dev.db"

# Server
PORT=3001
NODE_ENV=development

# JWT (para futuras implementaciones)
JWT_SECRET=tu_jwt_secret_super_seguro

# Cors (opcional)
CORS_ORIGIN=http://localhost:8085
```

### Scripts de Desarrollo Backend

```bash
# Desarrollo con hot-reload
npm run dev                  # Inicia servidor en puerto 3001

# Base de datos
npx prisma studio           # Interfaz web para ver/editar datos
npx prisma migrate reset    # Resetear base de datos
npx prisma db seed         # Poblar con datos de prueba (si existe)

# ProducciÃ³n
npm run build               # Compilar TypeScript
npm start                   # Ejecutar build de producciÃ³n
```

### URL del Backend
- **API**: http://localhost:3001
- **Health Check**: http://localhost:3001/health
- **Prisma Studio**: http://localhost:5555

## ğŸ”§ Flujo de Desarrollo Completo

### Iniciar Entorno de Desarrollo

#### **Terminal 1: Backend**
```bash
cd backend
npm run dev
# âœ… Backend running on http://localhost:3001
```

#### **Terminal 2: Frontend Web**
```bash
cd mobile
npm run web -- --port 8085
# âœ… Web app running on http://localhost:8085
```

#### **Terminal 3: Mobile Development (Opcional)**
```bash
cd mobile
npm start
# âœ… Expo DevTools running on http://localhost:19002
```

#### **Terminal 4: Database Management (Opcional)**
```bash
cd backend
npx prisma studio
# âœ… Database interface on http://localhost:5555
```

### VerificaciÃ³n de la InstalaciÃ³n

#### **1. Backend Health Check**
```bash
curl http://localhost:3001/health
# Esperado: {"status":"ok","timestamp":"..."}
```

#### **2. Frontend Web Access**
- Navegar a http://localhost:8085
- Verificar que aparece la pantalla de Kaia
- Probar el botÃ³n de voz (requiere permisos de micrÃ³fono)

#### **3. Mobile Development**
- Instalar Expo Go en tu mÃ³vil
- Escanear QR code desde Expo DevTools
- Verificar que la app se carga correctamente

## ğŸ› ï¸ Herramientas de Desarrollo

### VS Code Extensions Recomendadas

```json
{
  "recommendations": [
    "ms-vscode.vscode-typescript-next",
    "bradlc.vscode-tailwindcss",
    "ms-vscode.vscode-json",
    "esbenp.prettier-vscode",
    "ms-vscode.vscode-eslint",
    "prisma.prisma"
  ]
}
```

### ConfiguraciÃ³n de Prettier

Crear `.prettierrc` en la raÃ­z del proyecto:
```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2
}
```

### Git Hooks (Opcional)

Instalar Husky para hooks de pre-commit:
```bash
# En la raÃ­z del proyecto
npm install --save-dev husky
npx husky install
npx husky add .husky/pre-commit "npm run lint"
```

## ğŸ” Debugging y Troubleshooting

### Problemas Comunes

#### **Puerto ya en uso**
```bash
# Matar proceso en puerto especÃ­fico
lsof -ti:3001 | xargs kill -9    # Backend
lsof -ti:8085 | xargs kill -9    # Frontend

# O usar puertos alternativos
npm run web -- --port 8086
```

#### **Problemas de permisos de micrÃ³fono**
- **Chrome/Edge**: Verificar icono de micrÃ³fono en barra de direcciones
- **Firefox**: Limitado, usar Chrome para desarrollo
- **HTTPS**: Requerido para permisos de micrÃ³fono en producciÃ³n

#### **Base de datos corrupta**
```bash
cd backend
rm prisma/dev.db              # Eliminar base de datos
npx prisma db push           # Recrear esquema
```

#### **Node modules corruptos**
```bash
# Limpiar e instalar
rm -rf node_modules package-lock.json
npm install
```

### Logs de Desarrollo

#### **Backend Logs**
```bash
cd backend
npm run dev
# Los logs aparecen en consola con formato:
# [timestamp] METHOD /path - STATUS - response_time
```

#### **Frontend Logs**
```bash
# Consola del navegador (F12)
# Logs de voz aparecen con prefijos:
# ğŸ¤ (reconocimiento)
# ğŸ”Š (sÃ­ntesis)
# ğŸ§  (NLP)
```

### Performance Monitoring

#### **Expo DevTools**
- **Network**: Monitor API calls
- **Logs**: Ver logs en tiempo real
- **Performance**: MÃ©tricas de rendimiento

#### **Browser DevTools**
- **Network tab**: Verificar llamadas API
- **Console**: Logs de voz y NLP
- **Application**: LocalStorage y permisos

## ğŸ“¦ Deployment

### PreparaciÃ³n para ProducciÃ³n

#### **Frontend Build**
```bash
cd mobile
npm run build:web
# Output en: web-build/
```

#### **Backend Build**
```bash
cd backend
npm run build
# Output en: dist/
```

### Variables de Entorno ProducciÃ³n

#### **Backend (.env.production)**
```env
DATABASE_URL="postgresql://user:pass@host:port/db"
NODE_ENV=production
PORT=3001
CORS_ORIGIN=https://tu-dominio.com
```

#### **Frontend (expo build)**
```bash
# Configurar en app.json para builds mÃ³viles
npx expo build:android --release-channel production
npx expo build:ios --release-channel production
```

---
*GuÃ­a de desarrollo actualizada: 2024-12-29*