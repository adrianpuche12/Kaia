# ğŸ“Š Diagrama Entidad-RelaciÃ³n - Kaia Database

**VersiÃ³n:** 1.0.0
**Fecha:** 5 de octubre, 2025

---

## ğŸ—ºï¸ Diagrama ER Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              USUARIO CENTRAL                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    USER     â”‚
                              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                              â”‚ id          â”‚ PK
                              â”‚ email       â”‚ UNIQUE
                              â”‚ password    â”‚
                              â”‚ name        â”‚
                              â”‚ phone       â”‚ UNIQUE
                              â”‚ onboarding  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ UserPreferencesâ”‚   â”‚  Events  â”‚    â”‚  Reminders   â”‚
         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
         â”‚ id         PK  â”‚   â”‚ id    PK â”‚    â”‚ id        PK â”‚
         â”‚ userId     FK  â”‚   â”‚ userId FKâ”‚    â”‚ userId    FK â”‚
         â”‚ voiceEnabled   â”‚   â”‚ title    â”‚    â”‚ eventId   FK â”‚
         â”‚ timezone       â”‚   â”‚ startTimeâ”‚    â”‚ remindAt     â”‚
         â”‚ language       â”‚   â”‚ type     â”‚    â”‚ channel      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ placeId FK    â”‚ sent         â”‚
                              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
                              â”‚  Place   â”‚
                              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                              â”‚ id    PK â”‚
                              â”‚ userId FKâ”‚
                              â”‚ placeId  â”‚ UNIQUE
                              â”‚ latitude â”‚
                              â”‚ longitudeâ”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              SISTEMA DE IA                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    USER     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚           â”‚               â”‚              â”‚            â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”
    â”‚Context â”‚  â”‚Cluster â”‚    â”‚ Action  â”‚   â”‚Interactionâ”‚  â”‚Pattern â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚   Log     â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚id   PK â”‚  â”‚id   PK â”‚    â”‚id    PK â”‚   â”‚id      PK â”‚  â”‚id   PK â”‚
    â”‚userId FK  â”‚userId FK    â”‚userId FKâ”‚   â”‚userId  FK â”‚  â”‚userId FK
    â”‚entityIdâ”‚  â”‚name    â”‚    â”‚triggerIdâ”‚   â”‚action     â”‚  â”‚sequenceâ”‚
    â”‚entityType â”‚type    â”‚    â”‚actionType   â”‚entityId   â”‚  â”‚frequency
    â”‚temporalâ”‚  â”‚color   â”‚    â”‚confidence   â”‚duration   â”‚  â”‚confidence
    â”‚spatial â”‚  â”‚centroidâ”‚    â”‚state    â”‚   â”‚timestamp  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚priorityâ”‚  â”‚cohesionâ”‚    â”‚payload  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚relational  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚intentionalâ”‚                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚contextScore                                  â”‚UserFeedback  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                                                   â”‚id         PK â”‚
                                                   â”‚userId     FK â”‚
                                                   â”‚predictionId  â”‚
                                                   â”‚wasCorrect    â”‚
                                                   â”‚comment       â”‚
                                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           COMUNICACIÃ“N Y MENSAJES                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    USER     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚                â”‚
              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Contact  â”‚     â”‚  Message  â”‚   â”‚VoiceSession â”‚
              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
              â”‚ id    PK â”‚â—„â”€â”€â”€â”€â”¤ id     PK â”‚   â”‚ id       PK â”‚
              â”‚ userId FKâ”‚  1:Nâ”‚ userId FK â”‚   â”‚ userId   FK â”‚
              â”‚ name     â”‚     â”‚ contactId â”‚   â”‚ transcript  â”‚
              â”‚ phoneNumbers   â”‚ platform  â”‚   â”‚ intent      â”‚
              â”‚ emails   â”‚     â”‚ direction â”‚   â”‚ confidence  â”‚
              â”‚ hasWhatsApp    â”‚ content   â”‚   â”‚ response    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ status    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ read      â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             SISTEMA MCP                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   MCP    â”‚                    â”‚    USER     â”‚
              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â”‚ id    PK â”‚                           â”‚
              â”‚ name     â”‚                           â”‚
              â”‚ type     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ category â”‚         â”‚
              â”‚ capabilities       â”‚
              â”‚ executorCode   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ usageCount     â”‚MCPExecution  â”‚
              â”‚ enabled        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â”‚ id        PK â”‚
                   â”‚           â”‚ mcpId     FK â”‚â”€â”€â”€â”€â”€â”€â”
                   â”‚    1:N    â”‚ userId    FK â”‚      â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ inputData    â”‚      â”‚
                               â”‚ outputData   â”‚      â”‚
                               â”‚ success      â”‚      â”‚
                               â”‚ executionTimeMs     â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                                                     â”‚
                                             (Muchos ejecutores
                                              para un MCP)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             UBICACIÃ“N Y LUGARES                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    USER     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                 â”‚
              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
              â”‚LocationLog â”‚                   â”‚  Alarm   â”‚
              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
              â”‚ id      PK â”‚                   â”‚ id    PK â”‚
              â”‚ userId  FK â”‚                   â”‚ userId FKâ”‚
              â”‚ eventId FK â”‚                   â”‚ time     â”‚
              â”‚ latitude   â”‚                   â”‚ daysActive
              â”‚ longitude  â”‚                   â”‚ soundTypeâ”‚
              â”‚ accuracy   â”‚                   â”‚ musicUrl â”‚
              â”‚ action     â”‚                   â”‚ enabled  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 ANALYTICS                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚AppUsageLog   â”‚
                              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                              â”‚ id        PK â”‚
                              â”‚ userId       â”‚ (No FK, solo referencia)
                              â”‚ action       â”‚
                              â”‚ screen       â”‚
                              â”‚ metadata     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”— Relaciones Detalladas

### User como Centro del Sistema

**RelaciÃ³n 1:1**
- User â†’ UserPreferences (CASCADE delete)

**Relaciones 1:N**
- User â†’ Event (CASCADE delete)
- User â†’ Reminder (CASCADE delete)
- User â†’ Alarm (CASCADE delete)
- User â†’ VoiceSession (CASCADE delete)
- User â†’ Message (CASCADE delete)
- User â†’ Contact (CASCADE delete)
- User â†’ LocationLog (CASCADE delete)
- User â†’ Place (SET NULL delete)
- User â†’ MCPExecution (CASCADE delete)
- User â†’ Context (CASCADE delete)
- User â†’ Cluster (CASCADE delete)
- User â†’ Action (CASCADE delete)
- User â†’ InteractionLog (CASCADE delete)
- User â†’ Pattern (CASCADE delete)
- User â†’ UserFeedback (CASCADE delete)

### Relaciones entre Entidades

**Event â†” Place**
- Event.placeId â†’ Place.id (N:1, opcional)

**Event â†” Reminder**
- Reminder.eventId â†’ Event.id (N:1, CASCADE delete, opcional)

**Event â†” LocationLog**
- LocationLog.eventId â†’ Event.id (N:1, SET NULL, opcional)

**Contact â†” Message**
- Message.contactId â†’ Contact.id (N:1, CASCADE delete)

**MCP â†” MCPExecution**
- MCPExecution.mcpId â†’ MCP.id (N:1, CASCADE delete)

---

## ğŸ“Š Cardinalidad Visual

```
User (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (1) UserPreferences
  â”‚
  â”œâ”€â”€â”€ (1:N) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Event
  â”‚                         â”‚
  â”‚                         â”œâ”€â”€â”€ (1:N) â”€â”€â”€ Reminder
  â”‚                         â””â”€â”€â”€ (N:1) â”€â”€â”€ Place
  â”‚
  â”œâ”€â”€â”€ (1:N) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Alarm
  â”œâ”€â”€â”€ (1:N) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ VoiceSession
  â”‚
  â”œâ”€â”€â”€ (1:N) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Contact
  â”‚                         â”‚
  â”‚                         â””â”€â”€â”€ (1:N) â”€â”€â”€ Message
  â”‚
  â”œâ”€â”€â”€ (1:N) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LocationLog
  â”œâ”€â”€â”€ (1:N) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MCPExecution
  â”‚                         â”‚
  â”‚                         â””â”€â”€â”€ (N:1) â”€â”€â”€ MCP
  â”‚
  â”œâ”€â”€â”€ (1:N) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Context
  â”œâ”€â”€â”€ (1:N) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Cluster
  â”œâ”€â”€â”€ (1:N) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Action
  â”œâ”€â”€â”€ (1:N) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ InteractionLog
  â”œâ”€â”€â”€ (1:N) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Pattern
  â””â”€â”€â”€ (1:N) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ UserFeedback
```

---

## ğŸ¯ Flujos de Datos Principales

### 1. CreaciÃ³n de Evento con IA

```
Usuario crea evento
    â”‚
    â–¼
Event.create() â”€â”€â”€â”€â”€â”€â–º Event guardado en BD
    â”‚                       â”‚
    â”‚                       â–¼
    â”‚              Observer notifica
    â”‚                       â”‚
    â”‚                       â–¼
    â”‚              ContextBuilder.build()
    â”‚                       â”‚
    â”‚                       â–¼
    â”‚              Context.create() â”€â”€â–º Contexto guardado
    â”‚                       â”‚
    â”‚                       â–¼
    â”‚              TCAEngine analiza
    â”‚                       â”‚
    â”‚                       â–¼
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Action.create() â”€â”€â–º Sugerencia creada
```

### 2. Sistema de MensajerÃ­a

```
Usuario envÃ­a mensaje
    â”‚
    â–¼
Contact.findByName()
    â”‚
    â–¼
Message.create() â”€â”€â–º Mensaje guardado
    â”‚
    â–¼
MCPExecution.create() â”€â”€â–º WhatsApp MCP ejecutado
    â”‚
    â–¼
InteractionLog.create() â”€â”€â–º Log de interacciÃ³n
```

### 3. Clustering AutomÃ¡tico

```
Cron Job diario
    â”‚
    â–¼
Context.findMany() â”€â”€â–º Obtener todos los contextos
    â”‚
    â–¼
ClusteringEngine.cluster()
    â”‚
    â–¼
Cluster.createMany() â”€â”€â–º Clusters guardados
```

---

## ğŸ” PolÃ­ticas de EliminaciÃ³n

| RelaciÃ³n | PolÃ­tica | Motivo |
|----------|----------|--------|
| User â†’ * | CASCADE | Si se borra usuario, borrar todo |
| Event â†’ Reminder | CASCADE | Sin evento, no hay recordatorio |
| Event â†’ LocationLog | SET NULL | Mantener log histÃ³rico |
| Contact â†’ Message | CASCADE | Sin contacto, borrar mensajes |
| MCP â†’ MCPExecution | CASCADE | Sin MCP, borrar ejecuciones |
| Event â†’ Place | SET NULL | Mantener lugar aunque se borre evento |

---

## ğŸ“ˆ Ãndices Importantes

### Performance CrÃ­tico

```sql
-- BÃºsqueda de eventos por usuario y fecha
INDEX (userId, startTime)

-- Contextos por score
INDEX (userId, contextScore)

-- Acciones pendientes
INDEX (userId, state, createdAt)

-- Patrones por frecuencia
INDEX (userId, frequency)

-- Logs de interacciÃ³n por tiempo
INDEX (userId, timestamp)
```

---

## ğŸ§© Integridad Referencial

### Constraints AutomÃ¡ticos (Prisma)

```typescript
// Ejemplo: Event.placeId debe existir en Place.id
@relation(fields: [placeId], references: [id])

// Ejemplo: CASCADE delete
onDelete: Cascade

// Ejemplo: SET NULL delete
onDelete: SetNull
```

### Validaciones de Negocio

- **Email Ãºnico:** Validado a nivel BD
- **Phone Ãºnico:** Validado a nivel BD
- **placeId Ãºnico:** Para Google Places
- **entityId Ãºnico:** En Context (1 contexto por entidad)

---

**VersiÃ³n:** 1.0.0
**Ãšltima actualizaciÃ³n:** 5 de octubre, 2025
